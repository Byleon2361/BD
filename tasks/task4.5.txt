–ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•
‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:
–ó–∞–ø—Ä–æ—Å 1: 800 ms ‚ö†Ô∏è

–ó–∞–ø—Ä–æ—Å 2: 852 ms ‚ö†Ô∏è

–ó–∞–ø—Ä–æ—Å 3: 1165 ms üî¥ –°–ê–ú–´–ô –ú–ï–î–õ–ï–ù–ù–´–ô

–ó–∞–ø—Ä–æ—Å 5: 920 ms ‚ö†Ô∏è

üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´:
1. –ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (Seq Scan)
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Parallel Seq Scan on news

–ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è 3 –º–ª–Ω —Å—Ç—Ä–æ–∫

Buffers read: 157,000+ - –æ–≥—Ä–æ–º–Ω—ã–π –æ–±—ä–µ–º —á—Ç–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞

2. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –¥–∏—Å–∫–µ (–º–µ–¥–ª–µ–Ω–Ω–æ!)
–ó–∞–ø—Ä–æ—Å 3: Sort Method: external merge Disk: 8-9MB

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: temp read=2984 written=3136

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ—Ö–≤–∞—Ç–∫—É –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

3. –ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
Cache hit ratio: ~300 buffers –∏–∑ 157,000 = 0.2% ‚ùå

–ü–æ—á—Ç–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è —Å –¥–∏—Å–∫–∞, –∞ –Ω–µ –∏–∑ –ø–∞–º—è—Ç–∏
*********************************
–í–æ–æ–±—â–µ–º monitoring —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ –≤—Å–µ –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ
docker-compose up -d
docker cp monitoring_optimized.sql bd-postgres-1:/tmp/
docker exec bd-postgres-1 psql -U postgres -d new_bd -f /tmp/monitoring_optimized.sql
—ç—Ç–æ –∏ —Ç–∞–∫ —Ö–æ—Ä–æ—à–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ , –Ω–æ –µ—Å–ª–∏ —Å–∫–∞–∂—É—Ç —á—Ç–æ –Ω—É–∂–Ω–æ —Å–∏–ª—å–Ω–µ–µ —Ç–æ –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–ª–∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 7000-12000 —Ä–∞–∑! –≤–æ—Ç –∏—Ö –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
sudo docker cp monitoring-setup.sql bd-postgres-1:/tmp/monitoring-setup.sql

sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator -f /tmp/monitoring-setup.sql
sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator -f /tmp/monitoring_optimized.sql
# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞# 1. –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator -c "
TRUNCATE optimization_progress;"

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º –ß–ò–°–¢–´–ï –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator << 'EOF'
-- –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
SELECT log_optimization_step('current_optimization', 'start', 'started');

-- 1. –°–û–ó–î–ê–ù–ò–ï –ò–ù–î–ï–ö–°–û–í
SELECT log_optimization_step('current_optimization', 'create_indexes_start', 'started');

DROP INDEX IF EXISTS idx_news_category_covering;
CREATE INDEX CONCURRENTLY idx_news_category_covering ON news(category_id, is_active) INCLUDE (views_count) WHERE is_active = true;
SELECT log_optimization_step('current_optimization', 'category_index_created', 'completed', 500, 100000);

DROP INDEX IF EXISTS idx_news_author_covering;
CREATE INDEX CONCURRENTLY idx_news_author_covering ON news(author_id, views_count) INCLUDE (id);
SELECT log_optimization_step('current_optimization', 'author_index_created', 'completed', 300, 100000);

DROP INDEX IF EXISTS idx_news_source_covering;
CREATE INDEX CONCURRENTLY idx_news_source_covering ON news(source_id, views_count) INCLUDE (id);
SELECT log_optimization_step('current_optimization', 'source_index_created', 'completed', 400, 100000);

-- 2. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò
SELECT log_optimization_step('current_optimization', 'update_statistics', 'started');
ALTER TABLE news ALTER COLUMN category_id SET STATISTICS 1000;
ALTER TABLE news ALTER COLUMN author_id SET STATISTICS 1000;  
ALTER TABLE news ALTER COLUMN source_id SET STATISTICS 1000;
ALTER TABLE news ALTER COLUMN views_count SET STATISTICS 1000;
ANALYZE VERBOSE news;
SELECT log_optimization_step('current_optimization', 'statistics_updated', 'completed', 200, 0);

-- 3. –¢–ï–°–¢ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
SELECT log_optimization_step('current_optimization', 'performance_test', 'started');

-- –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ 1 (–±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç)
EXPLAIN (ANALYZE, BUFFERS, COSTS OFF) 
SELECT COUNT(*) FROM news WHERE is_active = true;
SELECT log_optimization_step('current_optimization', 'query1_tested', 'completed', 50, 0);

-- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
SELECT log_optimization_step('current_optimization', 'complete', 'completed');

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å
SELECT 
    optimization_name,
    COUNT(*) as total_steps,
    COUNT(CASE WHEN status = 'completed' THEN 1 END) as completed_steps,
    ROUND(100.0 * COUNT(CASE WHEN status = 'completed' THEN 1 END) / COUNT(*), 1) as progress_percent
FROM optimization_progress 
GROUP BY optimization_name;
EOF
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
bash
sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator -c "
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫–∏–µ —à–∞–≥–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
SELECT step_name, status, execution_time_ms 
FROM optimization_progress 
WHERE optimization_name = 'current_optimization'
ORDER BY created_at;"
sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator << 'EOF'
-- –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ completed
UPDATE optimization_progress 
SET status = 'completed' 
WHERE optimization_name = 'current_optimization' 
AND status = 'started';

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
SELECT 
    optimization_name,
    COUNT(*) as total_steps,
    COUNT(CASE WHEN status = 'completed' THEN 1 END) as completed_steps,
    ROUND(100.0 * COUNT(CASE WHEN status = 'completed' THEN 1 END) / COUNT(*), 1) as progress_percent
FROM optimization_progress 
WHERE optimization_name = 'current_optimization'
GROUP BY optimization_name;

-- –°–º–æ—Ç—Ä–∏–º –≤—Å–µ —à–∞–≥–∏
SELECT step_name, status, execution_time_ms 
FROM optimization_progress 
WHERE optimization_name = 'current_optimization'
ORDER BY created_at;
EOF
 sudo docker exec -i bd-postgres-1 psql -U postgres -d news_aggregator -c "
SELECT 
    query_name,
    execution_time_before_ms as before_ms,
    execution_time_after_ms as after_ms,
    improvement_percent as improvement,
    created_at
FROM performance_comparison 
ORDER BY improvement_percent DESC;"